customHeaders:
  # ====================================================================
  # GLOBAL HEADERS - Applied to all routes
  # ====================================================================
  - pattern: "**"
    headers:
      - key: "Content-Security-Policy"
        value: >
          default-src 'self';
          script-src 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval' 'self' data:
            https://js.pusher.com
            https://www.gstatic.com
            https://www.google.com/recaptcha/api.js
            https://www.googletagmanager.com
            https://www.google-analytics.com
            https://maps.googleapis.com
            https://cdn.polyfill.io
            https://polyfill.io
            https://bam.nr-data.net
            https://code.jquery.com
            https://cdnjs.cloudflare.com
            https://stackpath.bootstrapcdn.com
            https://use.fontawesome.com;
          style-src 'unsafe-inline' 'self'
            https://fonts.googleapis.com
            https://api.tiles.mapbox.com
            https://stackpath.bootstrapcdn.com;
          img-src 'self' data: blob:
            https://pennsieve-clin-prod-dataset-assets-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-dataset-assets-use1.s3.us-east-1.amazonaws.com
            https://pennsieve-clin-prod-storage-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-uploads-use1.s3.us-east-1.amazonaws.com
            https://prod-rejoin-storage-use1.s3.amazonaws.com
            https://prod-precision-storage-use1.s3.amazonaws.com
            https://prd-sparc-storage-use1.s3.amazonaws.com
            https://api.pennsieve.org
            https://api2.pennsieve.org
            https://assets.discover.pennsieve.org
            https://stats.g.doubleclick.net
            https://maps.gstatic.com
            https://www.google-analytics.com
            https://heapanalytics.com
            http://gravatar.com
            https://static.intercomassets.com
            https://downloads.intercomcdn.com
            https://uploads.intercomusercontent.com;
          font-src 'self' data: blob:
            https://fonts.gstatic.com;
          media-src blob:
            https://pennsieve-clin-prod-storage-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-uploads-use1.s3.us-east-1.amazonaws.com
            https://prod-rejoin-storage-use1.s3.amazonaws.com
            https://prod-precision-storage-use1.s3.amazonaws.com
            https://prd-sparc-storage-use1.s3.amazonaws.com
            https://api.pennsieve.org
            https://api2.pennsieve.org;
          frame-src 'self'
            https://www.google.com
            https://api.pennsieve.org
            https://api2.pennsieve.org
            https://pennsieve-clin-prod-storage-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-uploads-use1.s3.us-east-1.amazonaws.com
            https://prod-rejoin-storage-use1.s3.amazonaws.com
            https://prod-precision-storage-use1.s3.amazonaws.com
            https://prd-sparc-storage-use1.s3.amazonaws.com;
          worker-src 'self' blob:
            https://www.youtube.com
            https://player.vimeo.com
            https://fast.wistia.net;
          connect-src 'self'
            wss://*.pusher.com
            https://*.pusher.com
            *.pusherapp.com
            https://pub.sandbox.orcid.org
            https://pub.orcid.org
            https://citation.crosscite.org
            https://data.datacite.org
            https://doi.org
            https://www.google-analytics.com
            https://pennsieve-clin-prod-uploads-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-uploads-use1.s3.us-east-1.amazonaws.com
            https://pennsieve-clin-prod-storage-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-dataset-assets-use1.s3.amazonaws.com
            https://pennsieve-clin-prod-dataset-assets-use1.s3.us-east-1.amazonaws.com
            https://prod-rejoin-storage-use1.s3.amazonaws.com
            https://prod-precision-storage-use1.s3.amazonaws.com
            https://prd-sparc-storage-use1.s3.amazonaws.com
            https://bam.nr-data.net
            https://app.getsentry.com
            https://maps.tilehosting.com
            https://api.maptiler.com
            wss://notifications.pennsieve.org
            https://streaming.pennsieve.org
            wss://streaming.pennsieve.org
            wss://api.pennsieve.org
            https://api.pennsieve.org
            https://api2.pennsieve.org
            https://admin.api.pennsieve.org
            https://concepts.pennsieve.org
            https://s3.amazonaws.com
            https://discover.pennsieve.org;
          object-src 'self';
          frame-ancestors 'none';
          base-uri 'self';
          form-action 'self'

      # Additional Security Headers
      - key: "X-Frame-Options"
        value: "DENY"

      - key: "X-Content-Type-Options"
        value: "nosniff"

      - key: "X-XSS-Protection"
        value: "1; mode=block"

      - key: "Referrer-Policy"
        value: "strict-origin-when-cross-origin"

      - key: "Permissions-Policy"
        value: "camera=(), microphone=(), geolocation=(), payment=()"

      - key: "Strict-Transport-Security"
        value: "max-age=31536000; includeSubDomains"

  # ====================================================================
  # STATIC ASSETS - Performance optimized headers
  # ====================================================================
  - pattern: "/assets/**"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=11536000, immutable"

      - key: "Content-Security-Policy"
        value: >
          default-src 'self';
          img-src 'self' data: https:;
          style-src 'self' 'unsafe-inline'

# ========================================================================
# MAINTENANCE GUIDE:
# ========================================================================
#
# ADDING NEW DOMAINS:
# 1. Identify the correct CSP directive:
#    - script-src: JavaScript files and libraries
#    - style-src: CSS files and stylesheets
#    - img-src: Images, icons, graphics
#    - font-src: Web fonts
#    - connect-src: AJAX calls, APIs, WebSockets
#    - frame-src: Embedded iframes
#    - media-src: Audio/video files
#    - worker-src: Web workers (for video players)
#
# 2. Add the domain under the appropriate directive
# 3. Keep domains organized by service (Google, Pennsieve, CDNs, etc.)
# 4. Test in browser console for CSP violations
# 5. Deploy and monitor for blocked resources
#
# COMMON SERVICES BY CATEGORY:
# - Google: maps, analytics, fonts, recaptcha
# - Pennsieve: APIs, storage buckets, streaming
# - CDNs: jQuery, Bootstrap, FontAwesome, Polyfills
# - Analytics: Google Analytics, Heap, New Relic, Sentry
# - Communication: Pusher (WebSockets), Intercom
# - Research: ORCID, CrossCite, DataCite, DOI
#
# TESTING CSP:
# 1. Open browser dev tools â†’ Console
# 2. Look for messages like: "Content Security Policy: The page's settings blocked..."
# 3. Add the blocked domain to the appropriate directive
# 4. Commit changes and redeploy
# ========================================================================